!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.ID3Writer=t():e.ID3Writer=t()}(this,function(){return function(e){function t(n){if(r[n])return r[n].exports;var a=r[n]={exports:{},id:n,loaded:!1};return e[n].call(a.exports,a,a.exports,t),a.loaded=!0,a.exports}var r={};return t.m=e,t.c=r,t.p="",t(0)}([function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e){for(var t=[],r=255,n=24;n>=0;n-=8)t.push(e>>>n&r);return t}function i(e){for(var t=[],r=127,n=21;n>=0;n-=7)t.push(e>>>n&r);return t}function s(e){for(var t=0,r=0,n=21;n>=0;n-=7,r++)t+=e[r]<<n;return t}function o(e){return e.join("/")||"Unknown Artist"}function u(e){return e.join(";")}function c(e){var t=0;return e.forEach(function(e){t+=e.size}),t}function f(e){var t=10,r=1;return t+r+e}function l(e){var t=10,r=1,n=2,a=2*e;return t+r+n+a}function h(e,t){var r=10,n=1,a=2,i=2*e,s=2,o=2*t;return r+n+a+i+s+o}function y(e){var t=10,r=1,n=3,a=2,i=2,s=2*e;return t+r+n+i+a+i+s}function g(e,t){var r=10,n=1,a=1,i=1;return r+n+t+a+i+a+e}var m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},p=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),v=r(1),d=r(2),T=function(){function e(t){if(n(this,e),!(t&&"object"===("undefined"==typeof t?"undefined":m(t))&&"byteLength"in t))throw new Error("First argument should be an instance of ArrayBuffer or Buffer");this.arrayBuffer=t,this.padding=4096,this.frames=[],this.url=""}return p(e,[{key:"_setIntegerFrame",value:function(e,t){var r=parseInt(t,10);this.frames.push({name:e,value:r,size:f(r.toString().length)})}},{key:"_setStringFrame",value:function(e,t){var r=t.toString();this.frames.push({name:e,value:r,size:l(r.length)})}},{key:"_setPictureFrame",value:function(e,t){var r=d.getMimeType(new Uint8Array(t),0,12);if(!r)throw new Error("Unknown picture MIME type");this.frames.push({name:e,value:t,mimeType:r,size:g(t.byteLength,r.length)})}},{key:"_setLyricsFrame",value:function(e,t){var r=t.toString();this.frames.push({name:e,value:r,size:y(r.length)})}},{key:"_setUserStringFrame",value:function(e,t,r){var n=t.toString(),a=r.toString();this.frames.push({name:e,description:n,value:a,size:h(n.length,a.length)})}}]),p(e,[{key:"setFrame",value:function(e,t){switch(e){case"TPE1":case"TCOM":if(!Array.isArray(t))throw new Error(e+" frame value should be an array of strings");var r=t.map(function(e){return e.toString()}),n=o(r);this._setStringFrame(e,n);break;case"TCON":if(!Array.isArray(t))throw new Error(e+" frame value should be an array of strings");var a=t.map(function(e){return e.toString()}),i=u(a);this._setStringFrame(e,i);break;case"TKEY":if(!/^([A-G][#b]?m?|o)$/.test(t))throw new Error(e+" frame value should be like Dbm, C#, B or o");this._setStringFrame(e,t);break;case"TIT2":case"TALB":case"TPE2":case"TPE3":case"TPE4":case"TRCK":case"TPOS":case"TPUB":case"TBPM":case"TMED":case"TMOO":case"TSOA":case"TSOP":case"TSOT":this._setStringFrame(e,t);break;case"TLEN":case"TYER":this._setIntegerFrame(e,t);break;case"USLT":this._setLyricsFrame(e,t);break;case"TXXX":if(!("object"===("undefined"==typeof t?"undefined":m(t))&&"description"in t&&"value"in t))throw new Error("TXXX frame value should be an object with keys description and value");this._setUserStringFrame(e,t.description,t.value);break;case"APIC":if("object"!==("undefined"==typeof t?"undefined":m(t))||!("byteLength"in t))throw new Error("APIC frame value should be an instance of ArrayBuffer or Buffer");this._setPictureFrame(e,t);break;default:throw new Error("Unsupported frame "+e)}return this}},{key:"removeTag",value:function(){var e=10,t=this.arrayBuffer.byteLength;if(!(t<e)){var r=new Uint8Array(this.arrayBuffer,0,e),n=r[3],a=s([r[6],r[7],r[8],r[9]])+e;!d.isId3v2(r)||n<2||n>4||(this.arrayBuffer=this.arrayBuffer.slice(a))}}},{key:"addTag",value:function(){this.removeTag();var e=[255,254],t=10,r=c(this.frames),n=t+r+this.padding,s=new ArrayBuffer(this.arrayBuffer.byteLength+n),o=new Uint8Array(s),u=0,f=[];return f=[73,68,51,3],o.set(f,u),u+=f.length,u++,u++,f=i(n-t),o.set(f,u),u+=f.length,this.frames.forEach(function(r){switch(f=v.encodeUtf8Ascii(r.name),o.set(f,u),u+=f.length,f=a(r.size-t),o.set(f,u),u+=f.length,u+=2,r.name){case"TPE1":case"TCOM":case"TCON":case"TIT2":case"TALB":case"TPE2":case"TPE3":case"TPE4":case"TRCK":case"TPOS":case"TPUB":case"TBPM":case"TKEY":case"TMED":case"TMOO":case"TSOA":case"TSOP":case"TSOT":f=[1].concat(e),o.set(f,u),u+=f.length,f=v.encodeUtf16le(r.value),o.set(f,u),u+=f.length;break;case"TXXX":f=[1].concat(e),o.set(f,u),u+=f.length,f=v.encodeUtf16le(r.description),o.set(f,u),u+=f.length,f=[0,0],o.set(f,u),u+=f.length,f=v.encodeUtf16le(r.value),o.set(f,u),u+=f.length;break;case"USLT":var n=[101,110,103];f=[1].concat(n,e),o.set(f,u),u+=f.length,u+=2,f=e,o.set(f,u),u+=f.length,f=v.encodeUtf16le(r.value),o.set(f,u),u+=f.length;break;case"TLEN":case"TYER":u++,f=v.encodeUtf8Ascii(r.value),o.set(f,u),u+=f.length;break;case"APIC":u++,f=v.encodeUtf8Ascii(r.mimeType),o.set(f,u),u+=f.length,f=[0,3,0],o.set(f,u),u+=f.length,o.set(new Uint8Array(r.value),u),u+=r.value.byteLength}}),u+=this.padding,o.set(new Uint8Array(this.arrayBuffer),u),this.arrayBuffer=s,s}},{key:"getBlob",value:function(){return new Blob([this.arrayBuffer],{type:"audio/mpeg"})}},{key:"getURL",value:function(){return this.url||(this.url=URL.createObjectURL(this.getBlob())),this.url}},{key:"revokeURL",value:function(){URL.revokeObjectURL(this.url)}}]),e}();e.exports=T},function(e,t){"use strict";function r(e){var t=String(e).split("").map(function(e){var t=e.charCodeAt(0);if(t>127)throw new Error("Trying to encode not ASCII symbol");return t});return new Uint8Array(t)}function n(e){var t=String(e).split("").map(function(e){return e.charCodeAt(0)}),r=new Uint8Array(2*e.length);return new Uint16Array(r.buffer).set(t),r}e.exports={encodeUtf8Ascii:r,encodeUtf16le:n}},function(e,t){"use strict";function r(e){return 73===e[0]&&68===e[1]&&51===e[2]}function n(e){if(!e||!e.length)return null;if(255===e[0]&&216===e[1]&&255===e[2])return"image/jpeg";if(137===e[0]&&80===e[1]&&78===e[2]&&71===e[3])return"image/png";if(71===e[0]&&73===e[1]&&70===e[2])return"image/gif";if(87===e[8]&&69===e[9]&&66===e[10]&&80===e[11])return"image/webp";var t=73===e[0]&&73===e[1]&&42===e[2]&&0===e[3],r=77===e[0]&&77===e[1]&&0===e[2]&&42===e[3];return t||r?"image/tiff":66===e[0]&&77===e[1]?"image/bmp":0===e[0]&&0===e[1]&&1===e[2]&&0===e[3]?"image/x-icon":null}e.exports={isId3v2:r,getMimeType:n}}])});
//# sourceMappingURL=browser-id3-writer.min.js.map